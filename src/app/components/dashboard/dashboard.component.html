<div class="dashboard-container">
  <!-- Saldo principal -->
  <section class="balance-section">
    <div class="user-greeting">
      <div class="greeting-content">
        <h1>Olá!</h1>
        <p *ngIf="user">{{user.email}}</p>
      </div>
    </div>
    
    <div class="balance-card">
      <div class="balance-header">
        <span class="balance-label">Saldo total</span>
        <div class="header-actions">
          <button class="visibility-toggle" (click)="toggleBalanceVisibility()" [title]="isBalanceVisible ? 'Ocultar valores' : 'Mostrar valores'">
            <span class="material-icons">{{ isBalanceVisible ? 'visibility' : 'visibility_off' }}</span>
          </button>
          <button class="logout-btn" (click)="logout()" title="Sair">
            <span class="material-icons">logout</span>
          </button>
        </div>
      </div>
      <div class="balance-amount">
        <h2 *ngIf="!isLoadingBalance; else loadingBalance" [class.hidden-value]="!isBalanceVisible">
          {{ isBalanceVisible ? (currentBalance | currency:'BRL':'symbol':'1.2-2':'pt') : getHiddenValue(currentBalance) }}
        </h2>
        <ng-template #loadingBalance>
          <div class="balance-loading">
            <div class="balance-skeleton"></div>
          </div>
        </ng-template>
      </div>
      <div class="balance-variation positive">
        <span class="material-icons">trending_up</span>
        <span>Saldo atual</span>
      </div>
    </div>
  </section>

  <!-- Cards de resumo -->
  <section class="summary-section">
    <div class="summary-cards">
      <!-- Card de Receitas -->
      <div class="summary-card income" [class.large-value]="monthlyTotals.income && isLargeValue(monthlyTotals.income)">
        <div class="card-icon">
          <span class="material-icons">arrow_downward</span>
        </div>
        <div class="card-content">
          <span class="card-label">Receitas</span>
          <div class="card-amount-container">
            <span class="card-amount" [class.hidden-value]="!isBalanceVisible" *ngIf="!isLoadingTotals; else loadingIncome">
              {{ isBalanceVisible ? (monthlyTotals.income | currency:'BRL':'symbol':'1.2-2':'pt') : getHiddenValue(monthlyTotals.income) }}
            </span>
            <ng-template #loadingIncome>
              <div class="card-loading">
                <div class="loading-skeleton"></div>
              </div>
            </ng-template>
          </div>
        </div>
      </div>

      <!-- Card de Gastos -->
      <div class="summary-card expense" [class.large-value]="monthlyTotals.expense && isLargeValue(monthlyTotals.expense)">
        <div class="card-icon">
          <span class="material-icons">arrow_upward</span>
        </div>
        <div class="card-content">
          <span class="card-label">Gastos</span>
          <div class="card-amount-container">
            <span class="card-amount" [class.hidden-value]="!isBalanceVisible" *ngIf="!isLoadingTotals; else loadingExpense">
              {{ isBalanceVisible ? (monthlyTotals.expense | currency:'BRL':'symbol':'1.2-2':'pt') : getHiddenValue(monthlyTotals.expense) }}
            </span>
            <ng-template #loadingExpense>
              <div class="card-loading">
                <div class="loading-skeleton"></div>
              </div>
            </ng-template>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Ações rápidas -->
  <section class="quick-actions">
    <h3>Ações rápidas</h3>
    <div class="actions-grid">
      <button class="action-button primary" (click)="addTransaction()">
        <div class="action-icon">
          <span class="material-icons">add</span>
        </div>
        <span>Adicionar<br>transação</span>
      </button>

      <button class="action-button secondary" (click)="viewAnalytics()">
        <div class="action-icon">
          <span class="material-icons">analytics</span>
        </div>
        <span>Ver<br>relatórios</span>
      </button>
    </div>
  </section>

  <!-- Transações recentes -->
  <section class="recent-transactions">
    <div class="section-header">
      <h3>Transações recentes</h3>
      <button class="see-all-btn" (click)="viewAllTransactions()">Ver todas</button>
    </div>

    <div class="transactions-list">
      <!-- Loading skeleton para transações -->
      <ng-container *ngIf="!isLoadingTransactions; else loadingTransactions">
        <div class="transaction-item" *ngFor="let transaction of recentTransactions">
          <div class="transaction-icon" [class]="transaction.type">
            <span class="material-icons">{{ getCategoryIcon(transaction.category) }}</span>
          </div>
          <div class="transaction-details">
            <span class="transaction-title">{{ transaction.description }}</span>
            <span class="transaction-date">{{ formatDate(transaction.date) }}</span>
          </div>
          <span class="transaction-amount" [class]="transaction.type" [class.hidden-value]="!isBalanceVisible">
            {{ isBalanceVisible ? 
              (transaction.type === 'income' ? '+' : '-') + (transaction.amount | currency:'BRL':'symbol':'1.2-2':'pt') :
              (transaction.type === 'income' ? '+' : '-') + getHiddenValue(transaction.amount)
            }}
          </span>
        </div>

        <!-- Estado vazio -->
        <div class="empty-transactions" *ngIf="recentTransactions.length === 0">
          <div class="empty-icon">
            <span class="material-icons">receipt_long</span>
          </div>
          <p>Nenhuma transação ainda</p>
          <button class="add-first-transaction" (click)="addTransaction()">
            <span class="material-icons">add</span>
            Adicionar primeira transação
          </button>
        </div>
      </ng-container>

      <!-- Template de loading -->
      <ng-template #loadingTransactions>
        <div class="transaction-skeleton" *ngFor="let item of [1,2,3]">
          <div class="transaction-icon-skeleton"></div>
          <div class="transaction-details-skeleton">
            <div class="transaction-title-skeleton"></div>
            <div class="transaction-date-skeleton"></div>
          </div>
          <div class="transaction-amount-skeleton"></div>
        </div>
      </ng-template>
    </div>
  </section>
</div>
